{% extends "base.html" %} {% load static %} {% load crispy_forms_tags %}
<!--  Title  -->
{% block title %}Stations{% endblock %}

{% block css %}
	<script src="{% static 'dist/vendor/jquery/ajax-jquery-3.4.1.min.js' %}"></script>
	<link href="{% static 'dist/css/stationList.css' %}" rel="stylesheet">
 {% endblock %}


<!-- Page Name -->
{% block pageName %} Stations{% endblock %}

{% block content %}

<table class="table table-hover" id="station-table-list">
  <thead class="thead-dark">
    <tr>
      <th scope="col">number</th>
      <th scope="col">Station name</th>
      <th scope="col">Operator</th>
      <th scope="col">Date</th>
      <th scope="col">status</th>
      <th scope="col">delete</th>
    </tr>
  </thead>
  <tbody>
	{% for station in station_list %}
		{% if station.status == True %}
		    <tr class="table-success" data-station="{{station.station_name}}">
		      <th scope="row"><a href="{{ station.get_absolute_url }}">{{ forloop.counter }}</a></th>
		      <td><a href="{{ station.get_absolute_url }}">{{ station.station_name}}</a></td>
		      <td><a href="{{ station.get_absolute_url }}">{{station.operator.username}}</a></td>
		      <td><a href="{{ station.get_absolute_url }}">{{station.date}}</a></td>
		      <td><a href="{{ station.get_absolute_url }}">active</a></td>
		      <td id="user_delete_button" data-station="{{station.station_name}}"><button type="button" class="btn btn-secondary"><a>DELETE</a></button></td>
		    </tr>
		{% else %}
			<tr class="table-danger" data-station="{{station.station_name}}">
		      <th scope="row"><a href="{{ station.get_absolute_url }}">{{ forloop.counter }}</a></th>
		      <td><a href="{{ station.get_absolute_url }}">{{ station.station_name}}</a></td>
		      <td><a href="{{ station.get_absolute_url }}">{{station.operator.username}}</a></td>
		      <td><a href="{{ station.get_absolute_url }}">{{station.date}}</a></td>
		      <td><a href="{{ station.get_absolute_url }}">deactive</a></td>
		      <td id="user_delete_button" data-station="{{station.station_name}}"><button type="button" class="btn btn-secondary"><a>DELETE</a></button></td>
		    </tr>
		{% endif %}
    {% endfor %}
  </tbody>
</a>
</table>


<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">WARNING</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body2">
        Are you sure you want to delete this station?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger"data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success pull-right" id="delete_user">Yes</button>
      </div>
    </div>
  </div>
</div>



<script>
	
	function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }


    $(document).on('click', '#user_delete_button', function(event) {
		event.preventDefault();
		var data_station = $(this).data("station");
		window.value = data_station;
		$("#exampleModal").modal('show');
    });


    $(document).on('click', '#delete_user', function(event) {
        event.preventDefault();
        var data_station_delete = window.value;
        console.log(data_station_delete)
        var csrftoken = getCookie('csrftoken');
        $.ajax({
            type: "POST",
            url: "{% url 'station_delete' request.user.pk %}",
            data: {
                csrfmiddlewaretoken: csrftoken,
                'StationName': data_station_delete
            },
            success: function() {
                $("#exampleModal").modal('hide');
                $('tr[data-station="' + data_station_delete + '"]').remove();
            }
        });
    });


</script>

{% endblock %}